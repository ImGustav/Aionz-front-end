<div class="modal-container">
  <h1 mat-dialog-title class="modal-header">
    <div class="header-content">
      <div class="header-text">
        <span class="title">{{title}}</span>
        <span class="subtitle">{{subtitle}}</span>
      </div>
    </div>
    <button mat-icon-button class="close-btn" (click)="onCancel()">
      <mat-icon>close</mat-icon>
    </button>
  </h1>

  <div mat-dialog-content class="modal-content" [formGroup]="productForm">
    
    <div class="form-section" style="margin-top: 1vh;">
      <mat-form-field appearance="outline" class="form-field full-width">
        <mat-label>Nome do Produto</mat-label>
        <input matInput 
               formControlName="name" 
               required 
               placeholder="Ex: HQ do Capuz Vermelho">
        <mat-error *ngIf="productForm.get('name')?.hasError('required')">
          Nome é obrigatório
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-section">
      <mat-form-field appearance="outline" class="form-field full-width">
        <mat-label>Descrição</mat-label>
        <textarea matInput 
                  formControlName="description" 
                  placeholder="Descreva os detalhes do produto..."
                  rows="4"></textarea>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="form-field">
        <input matInput 
               type="string" 
               formControlName="price" 
               required 
               placeholder="0,00"
               (input)="formatCurrency($event)">
        <mat-error *ngIf="productForm.get('price')?.hasError('required')">
          Preço é obrigatório
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>Categoria</mat-label>
        <mat-select formControlName="category_id" required>
            <mat-option *ngFor="let category of categories$ | async" [value]="category.id">
              {{ category.name }}
            </mat-option>
        </mat-select>
        <mat-error *ngIf="productForm.get('category_id')?.hasError('required')">
          Categoria é obrigatória
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-section">
      <div class="upload-section">
        <div class="upload-label">
          <mat-icon>image</mat-icon>
          <span>Imagem do Produto</span>
        </div>
        <div class="upload-area" (click)="fileInput.click()">
          <div class="upload-content">
            <mat-icon class="upload-icon">cloud_upload</mat-icon>
            <p class="upload-text">
              <span class="upload-primary">Clique para fazer upload</span>
              <span class="upload-secondary">ou arraste e solte</span>
            </p>
            <span class="upload-hint">PNG, JPG ou WEBP (máx. 5MB)</span>
          </div>
          <input hidden 
                 type="file"
                 #fileInput
                 accept="image/*"
                 (change)="onFileSelected($event)">
        </div>
        <div class="file-info" *ngIf="fileName">
          <mat-icon class="file-icon">check_circle</mat-icon>
          <span class="file-name">{{ fileName }}</span>
          <button mat-icon-button 
                  class="remove-file-btn" 
                  (click)="removeFile(); $event.stopPropagation()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </div>

  </div>

  <div mat-dialog-actions class="modal-actions">
    <button mat-stroked-button 
            class="btn-cancel" 
            (click)="onCancel()">
      <mat-icon>close</mat-icon>
      Cancelar
    </button>
    <button mat-flat-button 
            color="primary" 
            class="btn-save"
            (click)="onSave()" 
            [disabled]="!productForm.valid">
      <mat-icon>check</mat-icon>
      Salvar Produto
    </button>
  </div>
</div>
